<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Heston Model">
  <title>Heston Model</title>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <style type="text/css">@font-face {
font-family: 'Roboto';
font-style: normal;
font-weight: 400;
font-display: swap;
}
@font-face {
font-family: 'Roboto';
font-style: normal;
font-weight: 400;
font-display: swap;
}
</style>
<style>
html {
color: #1a1a1a;
background-color: #fdfdfd;
}
body {
margin: 0 auto;
max-width: 36em;
padding-left: 50px;
padding-right: 50px;
padding-top: 50px;
padding-bottom: 50px;
hyphens: auto;
overflow-wrap: break-word;
text-rendering: optimizeLegibility;
font-kerning: normal;
}
@media (max-width: 600px) {
body {
font-size: 0.9em;
padding: 12px;
}
h1 {
font-size: 1.8em;
}
}
@media print {
html {
background-color: white;
}
body {
background-color: transparent;
color: black;
font-size: 12pt;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3, h4 {
page-break-after: avoid;
}
}
p {
margin: 1em 0;
}
a {
color: #1a1a1a;
}
a:visited {
color: #1a1a1a;
}
img {
max-width: 100%;
}
svg {
height: auto;
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
margin-top: 1.4em;
}
h5, h6 {
font-size: 1em;
font-style: italic;
}
h6 {
font-weight: normal;
}
ol, ul {
padding-left: 1.7em;
margin-top: 1em;
}
li > ol, li > ul {
margin-top: 0;
}
blockquote {
margin: 1em 0 1em 1.7em;
padding-left: 1em;
border-left: 2px solid #e6e6e6;
color: #606060;
}
code {
font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
font-size: 85%;
margin: 0;
hyphens: manual;
}
pre {
margin: 1em 0;
overflow: auto;
}
pre code {
padding: 0;
overflow: visible;
overflow-wrap: normal;
}
.sourceCode {
background-color: transparent;
overflow: visible;
}
hr {
background-color: #1a1a1a;
border: none;
height: 1px;
margin: 1em 0;
}
table {
margin: 1em 0;
border-collapse: collapse;
width: 100%;
overflow-x: auto;
display: block;
font-variant-numeric: lining-nums tabular-nums;
}
table caption {
margin-bottom: 0.75em;
}
tbody {
margin-top: 0.5em;
border-top: 1px solid #1a1a1a;
border-bottom: 1px solid #1a1a1a;
}
th {
border-top: 1px solid #1a1a1a;
padding: 0.25em 0.5em 0.25em 0.5em;
}
td {
padding: 0.125em 0.5em 0.25em 0.5em;
}
header {
margin-bottom: 4em;
text-align: center;
}
#TOC li {
list-style: none;
}
#TOC ul {
padding-left: 1.3em;
}
#TOC > ul {
padding-left: 0;
}
#TOC a:not(:hover) {
text-decoration: none;
}
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}
body {
text-align: justify; font-family: "Roboto", sans-serif;
line-height: 1.5; hyphens: auto;
}
h1,h2,h3,h4,h5,h6 {text-align:left; font-family: "Roboto Mono", monospace;}
h1.title {text-align:center; font-family: "Roboto Mono", monospace;}
code {font-family: "Roboto Mono", monospace;}
.sourceCode {font-family: "Roboto Mono", monospace;}
.navbar {
font-family: "Roboto Mono", monospace; background-color: #3D7068; font-size: 1.5em;
color: white;
}
.navbar a {color: white;}
.footer {
font-family: "Roboto Mono", monospace; background-color: #3D7068; font-size: 1em;
color: white;
}
.footer a {color: white;}
nav{
font-family: "Roboto Mono", monospace; font-size: 0.8em;
position: fixed;
right: 5em;
width: 20em;
border: 1px solid #36454F;
border-radius: 5px;
padding: 1em;
line-height: 2;
text-align: left;
}
@media (max-width: 1300px) {
nav {
display: none;
}
}
</style>
</head>
<body>
  <header>
    <h1></h1>
  </header>
  <div class="navbar">
    | <a href="/">Home</a> | <a href="/blog">Blog</a> |
  </div>
  <div class="content">
    <nav class="toc">
      <strong>Contents</strong>
      <ul>
      <li><a href="#introduction-heston"
      id="introduction-heston">Introduction</a></li>
      <li><a href="#derivation" id="derivation">Deriving the Asset Pricing Equation</a></li>
      <li><a href="#heston-calc"
      id="heston-calc">Calculator</a></li>
      </ul>
    </nav>
    <h1
      id="heston-model">The Heston Model</h1>
    <main class="main-content">
      <h2 id="introduction-heston">Introduction</h2> 
      <p> This blogpost serves as a portal for my extra credit project for the course Introduction to Quantitative Finance. For context,
      the last asset pricing model covered in the course was the Black-Scholes equation<a
      href="#fn1" class="footnote-ref" id="fnref1"
      role="doc-noteref"><sup>1</sup></a>. The Black-Scholes equation prices options by
      assuming that asset prices follow Brownian motion while asset price volatility is constant. The Black-Scholes model is widely popular
      due to its simplicity and ease of calculation. However, this can be a double-edged sword – critics often regard the simplification
      gained from assuming constant asset price volatility as an "oversimplification," leading to the need for a model that deals with asset
      price volatility in a more sophisticated manner.<br>
      <br>
      The Heston model<a
      href="#fn2" class="footnote-ref" id="fnref2"
      role="doc-noteref"><sup>2</sup></a> assumes that asset price volatility also follows Brownian motion, satisfying the same properties
      as standard Brownian motion. Then, similar to the Black-Scholes model, the Heston model utilises the properties of a no-arbitrage martingale
      to model the motions of asset price and its volatility.</p>
      <h2 id="derivation">Deriving the Asset Pricing Equation</h2>
      <p>Steven Heston proposed the following formulas to model the movement of asset prices, where prices and their volatility both follow
      Brownian motion:</p>
      \[\partial S_{t} = r\cdot S_{t}\cdot \partial t + \sqrt{V_{t}}\cdot S_t\cdot \partial W_{1t}^S\]
      \[\partial v_t = \kappa \cdot (\theta - V_{t})\cdot \partial t + \sigma_{V} \cdot \sqrt{V_{t}} \cdot \partial W_{2t}^V\]
      <p>where \(V_{t}\) represents the volatility (variance) of the asset price, \(\sigma\) represents the volatility (standard deviation)
      of this volatility, \(\theta\) represents the long-term price variance, \(\kappa\) represents the "rate-of-reversion" to the long-term 
       price variance, \(W_{1t}\) and \(W_{2t}\) represent the Brownian motion processes of the asset price and its volatility respectively, 
        and \(\rho\) represents the correlation coefficient between these Brownian processes.
      </p>
  <p>Now, we will apply Ito's Lemma to our definition of \( c(t, S_t, V_t) \), leading to the following terms:</p>
  <ul>
    <li>From \( dS_t \):</li>
    <p>
      First-order term: \( \frac{\partial c}{\partial S_t} \, dS_t = \frac{\partial c}{\partial S_t} \left( r S_t \, dt + \sqrt{V_t} S_t \, dW_t^1 \right) \) <br>
      Second-order term: \( \frac{1}{2} \frac{\partial^2 c}{\partial S_t^2} \, V_t S_t^2 \, dt \)
    </p>
    <li>From \( dV_t \):</li>
    <p>
      First-order term: \( \frac{\partial c}{\partial V_t} \, dV_t = \frac{\partial c}{\partial V_t} \left( \kappa (\theta - V_t) \, dt + \sigma \sqrt{V_t} \, dW_t^2 \right) \) <br>
      Second-order term: \( \frac{1}{2} \frac{\partial^2 c}{\partial V_t^2} \, \sigma^2 V_t \, dt \)
    </p>
    <li>Covariance term:</li>
    <p>
      \( dS_t dV_t = \rho \sigma V_t S_t \, dt \), contributing \( \frac{\partial^2 c}{\partial S_t \partial V_t} \, \rho \sigma V_t S_t \, dt \)
    </p>
  </ul>
      
  <p>Now, combining these terms, we derive the Heston PDE, which relates the option price to its payoffs:</p>
  <p>
    \( \frac{\partial c}{\partial t} + r S_t \frac{\partial c}{\partial S_t} + \frac{1}{2} V_t S_t^2 \frac{\partial^2 c}{\partial S_t^2} + \kappa (\theta - V_t) \frac{\partial c}{\partial V_t} + \frac{1}{2} \sigma^2 V_t \frac{\partial^2 c}{\partial V_t^2} + \rho \sigma V_t S_t \frac{\partial^2 c}{\partial S_t \partial V_t} - r c = 0 \)
  </p>

      <p>This further helps us arrive at the price of a European call option using the Heston model. The price of the call option is given by:</p>
<p>
  \[ C(t, S_t) = e^{-r(T-t)} \left[ S_t P_1 - K P_2 \right]\]

<p>Where:</p>
<ul>
  <li> \[ P_1 = \frac{1}{\pi} \int_0^\infty \text{Re} \left[ e^{-i\phi \ln S_t} \varphi(\phi) \right] d\phi \] </li>
  <li> \[ P_2 = \frac{1}{\pi} \int_0^\infty \text{Re} \left[ e^{-i\phi \ln K} \varphi(\phi) \right] d\phi \] </li>
</ul>

<p>And the characteristic function \( \varphi(\phi) \) is:</p>
<p>
  \[ \varphi(\phi) = \exp \left( i\phi \ln S_t + A(\phi) + B(\phi) v_0 \right)\]
</p>

   <h1 id="heston-calc">Option Pricing Calculator</h1>
  
  <form id="pricing-form">
    <label for="S0">Stock Price (S₀): <span class="value" id="S0-val">100</span></label>
    <input type="range" id="S0" min="50" max="200" value="100" step="1" oninput="updateSliderValue('S0', this.value)">
    
    <label for="K">Strike Price (K): <span class="value" id="K-val">100</span></label>
    <input type="range" id="K" min="50" max="200" value="100" step="1" oninput="updateSliderValue('K', this.value)">
    
    <label for="T">Time to Maturity (T): <span class="value" id="T-val">1</span> year</label>
    <input type="range" id="T" min="0.1" max="5" value="1" step="0.1" oninput="updateSliderValue('T', this.value)">
    
    <label for="r">Risk-Free Rate (r): <span class="value" id="r-val">0.05</span></label>
    <input type="range" id="r" min="0" max="0.2" value="0.05" step="0.01" oninput="updateSliderValue('r', this.value)">
    
    <label for="sigma">Volatility (σ): <span class="value" id="sigma-val">0.2</span></label>
    <input type="range" id="sigma" min="0.05" max="1" value="0.2" step="0.01" oninput="updateSliderValue('sigma', this.value)">
    
    <label for="v0">Initial Variance (v₀): <span class="value" id="v0-val">0.04</span></label>
    <input type="range" id="v0" min="0.01" max="1" value="0.04" step="0.01" oninput="updateSliderValue('v0', this.value)">
    
    <label for="kappa">Mean Reversion Rate (κ): <span class="value" id="kappa-val">2</span></label>
    <input type="range" id="kappa" min="0" max="5" value="2" step="0.1" oninput="updateSliderValue('kappa', this.value)">
    
    <label for="theta">Long-Term Variance (θ): <span class="value" id="theta-val">0.04</span></label>
    <input type="range" id="theta" min="0.01" max="0.5" value="0.04" step="0.01" oninput="updateSliderValue('theta', this.value)">
    
    <label for="rho">Correlation (ρ): <span class="value" id="rho-val">-0.5</span></label>
    <input type="range" id="rho" min="-1" max="1" value="-0.5" step="0.01" oninput="updateSliderValue('rho', this.value)">
    
    <button type="button" onclick="calculateOptionPrices()">Calculate Prices</button>
  </form>

  <p id="result-bs">Black-Scholes Price: </p>
  <p id="result-heston">Heston Model Price: </p>

  <script>
    // Black-Scholes Call Option Pricing Formula
    function blackScholes(S0, K, T, r, sigma) {
      const d1 = (Math.log(S0 / K) + (r + 0.5 * Math.pow(sigma, 2)) * T) / (sigma * Math.sqrt(T));
      const d2 = d1 - sigma * Math.sqrt(T);
      const cdf_d1 = cumulativeNormal(d1);
      const cdf_d2 = cumulativeNormal(d2);
      const price = S0 * cdf_d1 - K * Math.exp(-r * T) * cdf_d2;
      return price;
    }

    // Cumulative Normal Distribution Function
    function cumulativeNormal(x) {
      return 0.5 * (1 + Math.erf(x / Math.sqrt(2)));
    }

    // Heston Model Characteristic Function
    function hestonPhi(phi, S0, kappa, theta, sigma, rho, v0, T) {
      const i = Math.complex(0, 1);
      const A = (kappa * theta - 0.5 * Math.pow(sigma, 2)) * (1 - Math.exp(-kappa * T)) / kappa;
      const B = Math.sqrt(Math.pow(sigma, 2) * Math.pow(1 - Math.exp(-kappa * T), 2) + Math.pow(rho * sigma * T, 2)) / kappa;
      return Math.exp(i * phi * Math.log(S0) + A + B * v0);
    }

    // P1 and P2 for Heston Model Option Pricing
    function P1(S0, kappa, theta, sigma, rho, v0, T) {
      const integrand = (phi) => Math.real(Math.exp(-i * phi * Math.log(S0)) * hestonPhi(phi, S0, kappa, theta, sigma, rho, v0, T));
      return quad(integrand, 0, Infinity) / Math.PI;
    }

    function P2(S0, K, kappa, theta, sigma, rho, v0, T) {
      const integrand = (phi) => Math.real(Math.exp(-i * phi * Math.log(K)) * hestonPhi(phi, S0, kappa, theta, sigma, rho, v0, T));
      return quad(integrand, 0, Infinity) / Math.PI;
    }

    // Heston Option Price
    function hestonCall(S0, K, T, r, kappa, theta, sigma, rho, v0) {
      const P1_value = P1(S0, kappa, theta, sigma, rho, v0, T);
      const P2_value = P2(S0, K, kappa, theta, sigma, rho, v0, T);
      const price = Math.exp(-r * T) * (S0 * P1_value - K * P2_value);
      return price;
    }

    // Update slider value
    function updateSliderValue(sliderId, value) {
      document.getElementById(sliderId + '-val').innerText = value;
    }

    // Function to Calculate Both Option Prices
    function calculateOptionPrices() {
      const S0 = parseFloat(document.getElementById('S0').value);
      const K = parseFloat(document.getElementById('K').value);
      const T = parseFloat(document.getElementById('T').value);
      const r = parseFloat(document.getElementById('r').value);
      const sigma = parseFloat(document.getElementById('sigma').value);
      const v0 = parseFloat(document.getElementById('v0').value);
      const kappa = parseFloat(document.getElementById('kappa').value);
      const theta = parseFloat(document.getElementById('theta').value);
      const rho = parseFloat(document.getElementById('rho').value);

      // Calculate Black-Scholes Price
      const bsPrice = blackScholes(S0, K, T, r, sigma);
      document.getElementById('result-bs').innerText = `Black-Scholes Price: $${bsPrice.toFixed(2)}`;

      // Calculate Heston Model Price
      const hestonPrice = hestonCall(S0, K, T, r, kappa, theta, sigma, rho, v0);
      document.getElementById('result-heston').innerText = `Heston Model Price: $${hestonPrice.toFixed(2)}`;
    }
  </script>
        
        
  <section id="footnotes"
      class="footnotes footnotes-end-of-document" role="doc-endnotes">
      <hr />
      <ol>
      <li id="fn1"><p>Black, F., and Scholes, M. “The Pricing of Options and Corporate Liabilities.” Journal of Political Economy, vol. 81, no. 3, 1973, pp. 637–54.<a
      href="#fnref1" class="footnote-back"
      role="doc-backlink">↩︎</a></p></li>
      <li id="fn2"><p>S. Heston, “A Closed-Form Solution for Options with Stochastic Volatility with Applications to Bond
      and Currency Options.” The Review of Financial Studies (1993), 6, 327-343.<a href="fnref2" class="footnote-back" role="doc-backlink"></a></p></li>
        
   <footer class="footer">
    Contact: <a href="https://github.com/vedantmlhtr">[GitHub]</a> 
    <a href="https://www.linkedin.com/in/malhotra-vedant/">[LinkedIn]</a>
    <a href="mailto:malhotra.vedant@gmail.com">[Mail]</a>
  </footer>
</body>
</html>
